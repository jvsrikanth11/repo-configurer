name: Migrate Secrets
on:   
  [push]
        
jobs:
  Migrate-Secrets:
    runs-on: ubuntu-latest
    steps:
    
      # Check out repository code
      - name: Check out repository code
        uses: actions/checkout@main
      
      - name: setup python
        uses: actions/setup-python@v2
        with:
          python-version: 3.8 #install the python needed
      
      - name: fetch public_key
        id: fetch_public_key_id
        run: |
          curl --location --request GET 'https://api.github.com/repos/jvsrikanth11/scrs-configurer/actions/secrets/public-key' --header 'Authorization: token ${{ secrets.ACCESS_TOKEN }}' > response
      
      - name: Public_key response
        run: | 
          echo "Response --> ${{ steps.fetch_public_key_id.outputs.response }}"
      
      - name: Make encryption script file executeable
        run: |
          cd .github/scripts 
          python encrypt-secrets.py
          
